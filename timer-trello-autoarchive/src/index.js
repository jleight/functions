"use strict";function env(e){var t=process.env[e];if(!t)throw new Error("Environment variable "+e+" has not been defined!");return t}function main(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i;return __generator(this,function(o){switch(o.label){case 0:return t=new TrelloClient_1.default({key:env(KEY_VAR),token:env(TOKEN_VAR),list:env(LIST_VAR)}),[4,t.getCards()];case 1:n=o.sent().filter(function(e){return new Date(e.dateLastActivity).getDate()<TWO_WEEKS_AGO}).reverse(),r=0,a=n,o.label=2;case 2:return r<a.length?(i=a[r],e.log("card["+i.id+'] = "'+i.name+'"'),[4,t.archiveCard(i)]):[3,5];case 3:o.sent(),o.label=4;case 4:return r++,[3,2];case 5:return[2]}})})}var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,u)}l((r=r.apply(e,t)).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},TrelloClient_1=require("./utils/TrelloClient"),KEY_VAR="TRELLO_KEY",TOKEN_VAR="TRELLO_TOKEN",LIST_VAR="TRELLO_LIST",TWO_WEEKS_AGO=(new Date).getDate()-14;exports.__esModule=!0,exports.default=function(e){main(e).then(function(){return e.done()}).catch(function(t){return e.done(t)})};